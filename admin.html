<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin PPMTB</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <script type="module">
    // Pastikan inisialisasi supabase dilakukan di awal
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';

    const supabase = createClient('https://nkzpjtocjiluknfojmvq.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5renBqdG9jamlsdWtuZm9qbXZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1OTA1MzUsImV4cCI6MjA1ODE2NjUzNX0.ZKMZ0F1PlJUgxofw3hHkCUYyDYMCuJIgS0NWO0PIhVk');

    async function getFormData() {
      const { data, error } = await supabase
        .from('pengurusan')
        .select('*');

      if (error) {
        console.error('Error fetching form data:', error);
        return [];
      }
      return data;
    }

    // Setelah DOM dimuat, inisialisasi dan ambil data
    document.addEventListener('DOMContentLoaded', async () => {
      const formData = await getFormData();
      const tableBody = document.getElementById('data-table-body');
      
      formData.forEach((item) => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td class="px-4 py-2 border-b text-gray-700">${item.nama}</td>
          <td class="px-4 py-2 border-b text-gray-700">${item.nomor_wa}</td>
          <td class="px-4 py-2 border-b text-gray-700">${item.keperluan}</td>
          
          <!-- Foto KTP -->
          <td class="px-4 py-2 border-b text-gray-700">
            <a href="https://nkzpjtocjiluknfojmvq.supabase.co/storage/v1/object/uploads/${item.foto_ktp}?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJ1cGxvYWRzL2ZvdG9fa2svRkJfSU1HXzE3NDIyMjg2OTcyMzQuanBnIiwiaWF0IjoxNzQyNjA0ODE4LCJleHAiOjE3NDMyMDk2MTh9.s7dAW0r6It0XKyuy3D6C5mB6kxwHanSiJowrNlfLf4Q" class="text-blue-600 hover:underline" target="_blank">Lihat KTP</a>
          </td>
          
          <!-- Foto KK -->
          <td class="px-4 py-2 border-b text-gray-700">
            <a href="https://nkzpjtocjiluknfojmvq.supabase.co/storage/v1/object/uploads/${item.foto_kk}?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJ1cGxvYWRzL2ZvdG9fa2svRkJfSU1HXzE3NDIyMjg2OTcyMzQuanBnIiwiaWF0IjoxNzQyNjA0ODE4LCJleHAiOjE3NDMyMDk2MTh9.s7dAW0r6It0XKyuy3D6C5mB6kxwHanSiJowrNlfLf4Q" class="text-blue-600 hover:underline" target="_blank">Lihat KK</a>
          </td>
          
          <!-- Surat Tambahan 1 -->
          <td class="px-4 py-2 border-b text-gray-700">
            <a href="https://nkzpjtocjiluknfojmvq.supabase.co/storage/v1/object/uploads/${item.surat_tambahan1}?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJ1cGxvYWRzL2ZvdG9fa2svRkJfSU1HXzE3NDIyMjg2OTcyMzQuanBnIiwiaWF0IjoxNzQyNjA0ODE4LCJleHAiOjE3NDMyMDk2MTh9.s7dAW0r6It0XKyuy3D6C5mB6kxwHanSiJowrNlfLf4Q" class="text-blue-600 hover:underline" target="_blank">Lihat Surat 1</a>
          </td>

          <!-- Surat Tambahan 2 -->
          <td class="px-4 py-2 border-b text-gray-700">
            <a href="https://nkzpjtocjiluknfojmvq.supabase.co/storage/v1/object/uploads/${item.surat_tambahan2}?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJ1cGxvYWRzL2ZvdG9fa2svRkJfSU1HXzE3NDIyMjg2OTcyMzQuanBnIiwiaWF0IjoxNzQyNjA0ODE4LCJleHAiOjE3NDMyMDk2MTh9.s7dAW0r6It0XKyuy3D6C5mB6kxwHanSiJowrNlfLf4Q" class="text-blue-600 hover:underline" target="_blank">Lihat Surat 2</a>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    });
  </script>
  <script src="https://cdn.tailwindcss.com">
    
  </script>
  <script>
    if (localStorage.getItem("adminLoggedIn") !== "true") {
        window.location.href = "admin-login.html";
    }
</script>
</head>
<body class="bg-green-50 font-poppins">
  <div class="container mx-auto p-6 bg-white shadow-lg rounded-lg mt-10 max-w-6xl">
    <h1 class="text-3xl font-bold text-center text-green-600 mb-6">Admin PPMTB</h1>

    <table class="w-full table-auto border-collapse bg-white rounded-lg shadow-md">
      <thead class="bg-green-600 text-white">
        <tr>
          <th class="px-6 py-3 text-left">Nama</th>
          <th class="px-6 py-3 text-left">Nomor WA</th>
          <th class="px-6 py-3 text-left">Keperluan</th>
          <th class="px-6 py-3 text-left">Foto KTP</th>
          <th class="px-6 py-3 text-left">Foto KK</th>
          <th class="px-6 py-3 text-left">Surat Tambahan 1</th>
          <th class="px-6 py-3 text-left">Surat Tambahan 2</th>
        </tr>
      </thead>
      <tbody id="data-table-body">
        <!-- Data akan diisi oleh script -->
      </tbody>
    </table>
  </div>
</body>
</html>
